var $,_,container,controls,d3,gameNum,height,listGames,listPlays,loadGame,moment,nextGame,oaklandNestedGames,onlyShow,sortGameByTime,svg,t,tooltip,vizGame,width;d3=require("d3"),_=require("lodash"),moment=require("moment"),$=require("jquery"),oaklandNestedGames=[],gameNum=1,width=$(window).width(),height=$(window).height(),t=d3.transition().duration(1250).ease(d3.easeQuad),container=d3.select("#container"),controls=container.append("div").attr("id","controls"),tooltip=container.append("div").attr("id","tooltip"),svg=container.append("svg").attr("width",width).attr("height",height),d3.csv("data/pbp-2016.csv",function(e){var t;return t=_.filter(e,function(e){return"OAK"===e.DefenseTeam||"OAK"===e.OffenseTeam}),oaklandNestedGames=d3.nest().key(function(e){return e.GameId}).entries(t),loadGame(1)}),nextGame=function(){var e;return e=gameNum+1,loadGame(e)},loadGame=function(e){return gameNum=e,vizGame(oaklandNestedGames[e])},sortGameByTime=function(e){return e.forEach(function(e){var t,n,o;return t=e.Minute,o=e.Second,n=moment({minute:t,second:o}),e.Timestamp=+n}),e=_(e).chain().sortBy("Timestamp").sortBy("Quarter").value()},onlyShow=function(e){return svg=d3.select("svg"),d3.select("#centerlabel").text(e),svg.selectAll("circle").transition(t).style("opacity",function(t){return 1==+t[e]?1:0})},vizGame=function(e){var n;return e.key,e=e.values,e=sortGameByTime(e),console.log("game data!",e[0],e),d3.scaleOrdinal(d3.schemeCategory10),d3.select("#centerlabel").style("top",height/2.15+"px").text(function(t){return e[10].OffenseTeam+" vs "+e[10].DefenseTeam}),n=svg.selectAll("circle").data(e),n.exit().remove(),n.enter().append("circle").attr("cx",width/2).attr("cy",height/2).attr("r",function(e,t){return 5*t}).style("fill","none").on("mouseover",function(e){var t,n;return t=d3.mouse(this),tooltip.text(e.Description),n=14,tooltip.style("left",t[0]+n+"px"),tooltip.style("top",t[1]+n+"px"),d3.select(this).style("stroke","red")}).on("mouseout",function(e){return d3.select(this).style("stroke",function(e){return 1==+e.IsTouchdown?"green":"black"})}),svg.selectAll("circle").transition(t).attr("class","playstroke").style("opacity",function(e){}).style("stroke",function(e){return 1==+e.IsTouchdown?"green":"black"}).style("stroke-width",function(e){return"OAK"===e.DefenseTeam?2:1}),controls.html(""),controls.append("button").text("Pass").on("mousedown",function(){return onlyShow("IsPass")}),controls.append("button").text("Rush").on("mousedown",function(){return onlyShow("IsRush")}),controls.append("button").text("Fumble").on("mousedown",function(){return onlyShow("IsFumble")}),controls.append("button").text("Incomplete").on("mousedown",function(){return onlyShow("IsIncomplete")}),controls.append("button").text("Load Game 10").on("mousedown",function(){return loadGame(10)}),controls.append("button").text("Load Game 5").on("mousedown",function(){return loadGame(5)}),controls.append("button").text("Next Game").on("mousedown",function(){return nextGame()})},listPlays=function(e){return e.key,e=e.values,e=sortGameByTime(e),console.log("game data!",e[0]),container=d3.select("#container").append("div").attr("id","game"),container.selectAll("p").data(e).enter().append("p").style("border-bottom","1px solid black").style("font-size",10).html(function(e){return e.Description})},listGames=function(e){return container=d3.select("#container").append("div").attr("id","gamelist"),container.selectAll("div").data(e).enter().append("div").html(function(e){var t;return t=e.key+" ",t+=e.values[0].OffenseTeam+" vs "+e.values[0].DefenseTeam})};